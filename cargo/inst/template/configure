#!/bin/sh

cat <<'EOF' | "${R_HOME}/bin${R_ARCH_BIN}/Rscript" -

source("tools/cargo_run.R")

setwd("src/rust")
if ( ! dir.exists("vendor") ) untar("vendor.tar.xz", tar="internal")

con <- file("../../inst/cargo.log", "w")
if ( run('build', '--offline', '--release', '--jobs', '2', minimum_version='../..', cargo_home_method="tempdir", verbose=con) == 0 ) {

    file.copy("target/release/librust.a", "..", overwrite=TRUE)
    message("Built Rust static library.")

} else {

    message("No suitable version of Cargo was found.\nOne solution is to run 'install()' from the 'cargo' package.")

}
close(con)

EOF
